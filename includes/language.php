<?php

declare(strict_types=1);

/**
 * Multilingual Support - English and Filipino (Tagalog)
 */

// Language strings
$GLOBALS['lang_strings'] = [
    'en' => [
        // General
        'site_name' => 'Healthcare Center',
        'home' => 'Home',
        'about' => 'About',
        'blog' => 'Blog',
        'careers' => 'Careers',
        'contact' => 'Contact',
        'search' => 'Search',
        'search_placeholder' => 'Search posts...',
        'login' => 'Login',
        'logout' => 'Logout',
        'admin' => 'Admin',
        
        // Common
        'read_more' => 'Read More',
        'view_all' => 'View All',
        'submit' => 'Submit',
        'cancel' => 'Cancel',
        'save' => 'Save',
        'edit' => 'Edit',
        'delete' => 'Delete',
        'back' => 'Back',
        'next' => 'Next',
        'previous' => 'Previous',
        'loading' => 'Loading...',
        'no_results' => 'No results found',
        'all' => 'All',
        
        // Blog
        'latest_stories' => 'Latest Stories',
        'recent_posts' => 'Recent Posts',
        'published_on' => 'Published on',
        'by_author' => 'By',
        'in_category' => 'in',
        'tags' => 'Tags',
        'categories' => 'Categories',
        'filter_by_date' => 'Filter by Date',
        'filter_by_category' => 'Filter by Category',
        'share' => 'Share',
        'related_posts' => 'Related Posts',
        'no_posts' => 'No posts available',
        'views' => 'views',
        
        // About
        'our_story' => 'Our Story',
        'mission' => 'Mission',
        'vision' => 'Vision',
        'values' => 'Values',
        'what_drives_us' => 'What Drives Us',
        'years_serving' => 'Years Serving Communities',
        'community_programs' => 'Community Programs',
        'published_stories' => 'Published Stories',
        
        // Careers
        'job_openings' => 'Job Openings',
        'apply_now' => 'Apply Now',
        'department' => 'Department',
        'location' => 'Location',
        'employment_type' => 'Employment Type',
        'salary_range' => 'Salary Range',
        'requirements' => 'Requirements',
        'posted_date' => 'Posted',
        'closes_on' => 'Closes on',
        'no_jobs' => 'No job openings at this time',
        
        // Contact
        'contact_us' => 'Contact Us',
        'get_in_touch' => 'Get in Touch',
        'your_name' => 'Your Name',
        'your_email' => 'Your Email',
        'subject' => 'Subject',
        'message' => 'Message',
        'send_message' => 'Send Message',
        'address' => 'Address',
        'phone' => 'Phone',
        'email' => 'Email',
        'hours' => 'Hours',
        
        // Footer
        'all_rights_reserved' => 'All rights reserved',
        'admin_login' => 'Admin Login',
        
        // Errors
        'error_occurred' => 'An error occurred',
        'page_not_found' => 'Page not found',
        'access_denied' => 'Access denied',
        
        // Forms
        'required_field' => 'This field is required',
        'invalid_email' => 'Please enter a valid email',
        'form_submitted' => 'Form submitted successfully',
    ],
    
    'ph' => [
        // General
        'site_name' => 'Healthcare Center',
        'home' => 'Tahanan',
        'about' => 'Tungkol',
        'blog' => 'Blog',
        'careers' => 'Karera',
        'contact' => 'Makipag-ugnayan',
        'search' => 'Maghanap',
        'search_placeholder' => 'Maghanap ng mga post...',
        'login' => 'Mag-login',
        'logout' => 'Mag-logout',
        'admin' => 'Admin',
        
        // Common
        'read_more' => 'Magbasa Pa',
        'view_all' => 'Tingnan Lahat',
        'submit' => 'Isumite',
        'cancel' => 'Kanselahin',
        'save' => 'I-save',
        'edit' => 'I-edit',
        'delete' => 'Tanggalin',
        'back' => 'Bumalik',
        'next' => 'Susunod',
        'previous' => 'Nakaraan',
        'loading' => 'Naglo-load...',
        'no_results' => 'Walang resulta',
        'all' => 'Lahat',
        
        // Blog
        'latest_stories' => 'Pinakabagong Kwento',
        'recent_posts' => 'Mga Kamakailang Post',
        'published_on' => 'Inilathala noong',
        'by_author' => 'Ni',
        'in_category' => 'sa',
        'tags' => 'Mga Tag',
        'categories' => 'Mga Kategorya',
        'filter_by_date' => 'I-filter ayon sa Petsa',
        'filter_by_category' => 'I-filter ayon sa Kategorya',
        'share' => 'Ibahagi',
        'related_posts' => 'Mga Kaugnay na Post',
        'no_posts' => 'Walang mga post',
        'views' => 'mga view',
        
        // About
        'our_story' => 'Ang Aming Kwento',
        'mission' => 'Misyon',
        'vision' => 'Bisyon',
        'values' => 'Mga Halaga',
        'what_drives_us' => 'Ano ang Nagtutulak sa Amin',
        'years_serving' => 'Mga Taon ng Paglilingkod sa Komunidad',
        'community_programs' => 'Mga Programa sa Komunidad',
        'published_stories' => 'Mga Nailathala na Kwento',
        
        // Careers
        'job_openings' => 'Mga Bakanteng Trabaho',
        'apply_now' => 'Mag-apply Ngayon',
        'department' => 'Departamento',
        'location' => 'Lokasyon',
        'employment_type' => 'Uri ng Empleo',
        'salary_range' => 'Saklaw ng Sahod',
        'requirements' => 'Mga Kinakailangan',
        'posted_date' => 'Nai-post',
        'closes_on' => 'Magsasara sa',
        'no_jobs' => 'Walang mga bakanteng trabaho sa ngayon',
        
        // Contact
        'contact_us' => 'Makipag-ugnayan sa Amin',
        'get_in_touch' => 'Makipag-ugnayan',
        'your_name' => 'Iyong Pangalan',
        'your_email' => 'Iyong Email',
        'subject' => 'Paksa',
        'message' => 'Mensahe',
        'send_message' => 'Ipadala ang Mensahe',
        'address' => 'Address',
        'phone' => 'Telepono',
        'email' => 'Email',
        'hours' => 'Oras',
        
        // Footer
        'all_rights_reserved' => 'Lahat ng karapatan ay nakalaan',
        'admin_login' => 'Admin Login',
        
        // Errors
        'error_occurred' => 'May naganap na error',
        'page_not_found' => 'Hindi natagpuan ang pahina',
        'access_denied' => 'Hindi pinapayagan ang access',
        
        // Forms
        'required_field' => 'Kinakailangan ang field na ito',
        'invalid_email' => 'Mangyaring maglagay ng wastong email',
        'form_submitted' => 'Matagumpay na naisumite ang form',
    ],
];

/**
 * Get current language (default: en)
 */
function get_language(): string
{
    // Check URL parameter first
    if (isset($_GET['lang']) && in_array($_GET['lang'], ['en', 'ph'], true)) {
        $_SESSION['language'] = $_GET['lang'];
        return $_GET['lang'];
    }
    
    // Then session
    if (isset($_SESSION['language'])) {
        return $_SESSION['language'];
    }
    
    // Default to English
    return 'en';
}

/**
 * Set the current language
 */
function set_language(string $lang): void
{
    if (in_array($lang, ['en', 'ph'], true)) {
        $_SESSION['language'] = $lang;
    }
}

/**
 * Get a translated string
 */
function __($key, ?string $lang = null): string
{
    $lang = $lang ?? get_language();
    return $GLOBALS['lang_strings'][$lang][$key] ?? $GLOBALS['lang_strings']['en'][$key] ?? $key;
}

/**
 * Echo a translated string (escaped)
 */
function _e($key, ?string $lang = null): void
{
    echo e(__($key, $lang));
}

/**
 * Get localized content from a record (for posts, categories, etc.)
 * Returns the localized version if available, otherwise the default
 */
function get_localized(array $record, string $field, ?string $lang = null): string
{
    $lang = $lang ?? get_language();
    
    if ($lang === 'ph') {
        $localizedField = $field . '_ph';
        if (!empty($record[$localizedField])) {
            return $record[$localizedField];
        }
    }
    
    return $record[$field] ?? '';
}

/**
 * Generate language switcher URL
 */
function get_language_switch_url(string $targetLang): string
{
    $currentUrl = $_SERVER['REQUEST_URI'];
    $parsed = parse_url($currentUrl);
    $path = $parsed['path'] ?? '';
    
    // Parse existing query string
    $query = [];
    if (isset($parsed['query'])) {
        parse_str($parsed['query'], $query);
    }
    
    // Set new language
    $query['lang'] = $targetLang;
    
    return $path . '?' . http_build_query($query);
}

/**
 * Check if current language is Filipino
 */
function is_filipino(): bool
{
    return get_language() === 'ph';
}

/**
 * Check if current language is English
 */
function is_english(): bool
{
    return get_language() === 'en';
}

